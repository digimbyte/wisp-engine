[env:esp32-c6-lcd]
; ESP32-C6-LCD-1.47 Development Board (MINIMAL BUILD)
; Features: 172Ã—320 portrait display, WiFi 6, Bluetooth 5 LE, 512KB HP SRAM
platform = espressif32
board = esp32-c6-devkitm-1
framework = espidf
monitor_speed = 115200
upload_speed = 921600

; Minimal library dependencies for memory-constrained ESP32-C6
lib_deps = 
    lovyan03/LovyanGFX

build_flags =
  -std=c++17
  -DPLATFORM_C6=1
  -DESP32_C6_LCD_1_47=1
  -DDISPLAY_WIDTH=172
  -DDISPLAY_HEIGHT=320
  -DDISPLAY_CONTROLLER_ST7789=1
  -DCPU_FREQ_MHZ=160
  -DMEMORY_HP_SRAM_KB=512
  -DMEMORY_LP_SRAM_KB=16
  -DFLASH_SIZE_MB=4
  -DWIFI_6_SUPPORT=1
  -DBLUETOOTH_5_LE=1
  -DWISP_MEMORY_PROFILE=0
  -DWISP_MINIMAL_BUILD=1
  -DCONFIG_COMPILER_OPTIMIZATION_SIZE=1
  -Os
  -ffunction-sections
  -fdata-sections
  -Wl,--gc-sections
  -DLGFX_ESP32_REDUCE_FONTS=1
  -DLGFX_DISABLE_MULTITASK=1
  -DLGFX_REDUCE_CPUFREQ=1
  -Iboards/
  -Isrc/
  -Isrc/engine/
  -Isrc/system/
  -Isrc/core/
  -Isrc/utils/

; Exclude heavy components for ESP32-C6 memory constraints
src_filter = 
  +<*>
  -<src/engine/audio/>
  -<src/engine/graphics/advanced/>
  -<src/engine/app/bundles/>
  -<src/engine/database/wbdf/>
  -<src/engine/physics/>
  -<src/engine/entities/>
  -<src/lib/>
  -<tests/>

; ESP32-C6 specific memory settings
board_build.partitions = partitions_c6_minimal.csv
board_build.embed_txtfiles = 
  ; Empty - don't embed large text files

; =============================================================================
; WISP ENGINE - CLEAN BUILD CONFIGURATION
; =============================================================================
; This platformio.ini is designed to work with the build script:
;   .\tools\build.ps1 -board "board-name"
;
; The build script reads configs/boards/board-name.config and automatically
; sets all build flags via environment variables - no manual config needed!
; =============================================================================

[platformio]
default_envs = wisp-build

[env:wisp-build]
; Universal environment that gets configured by build script
platform = espressif32
; Board will be set by ENV_BOARD from build script
board = ${sysenv.ESP_BOARD_TYPE, esp32-c6-devkitm-1}
framework = espidf
monitor_speed = 115200
upload_speed = 921600
monitor_filters = esp32_exception_decoder

; Essential libraries
lib_deps = 
    lovyan03/LovyanGFX

; Base build configuration
build_flags =
    -std=c++17
    ; Core Wisp Engine
    -DWISP_ENGINE_VERSION=\"1.0.0\"
    ; Updated include paths for reorganized structure
    -Iconfigs/boards/
    -Isrc/
    -Isrc/engine/
    -Isrc/system/
    -Isrc/core/
    -Isrc/utils/
    ; Board-specific flags will be added by build script via PLATFORMIO_BUILD_FLAGS
    ${sysenv.PLATFORMIO_BUILD_FLAGS}

; Source filtering (can be overridden by build script)
src_filter = 
    +<*>
    -<test/>
    -<legacy/>
    ; Additional filters can be set by build script via PLATFORMIO_SRC_FILTER
    ${sysenv.PLATFORMIO_SRC_FILTER}

; Board configuration (set by build script environment variables)
board_build.flash_mode = ${sysenv.ESP_FLASH_MODE, qio}
board_build.f_cpu = ${sysenv.ESP_CPU_FREQ, 240000000L}
board_build.flash_size = ${sysenv.ESP_FLASH_SIZE, 4MB}

; PSRAM configuration (if supported by board)
board_build.memory_type = ${sysenv.ESP_MEMORY_TYPE, dio_qspi}
board_build.psram_type = ${sysenv.ESP_PSRAM_TYPE, opi}
board_upload.flash_size = ${sysenv.ESP_FLASH_SIZE, 4MB}

; Partition table (set by build script if needed)
board_build.partitions = ${sysenv.ESP_PARTITION_TABLE, default.csv}
